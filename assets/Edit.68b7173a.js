import{p as e,h as t,r as a,j as i,o,c as s,a as l,m as r,k as d,F as n,l as c,b as m,t as u,i as p,v as h}from"./vendor.e3454a14.js";const y=p();e("data-v-3bf4742c");const g={id:"Edit"},f={class:"toolBar marginTop"},k=m("Play"),v=m("Pause"),w=m("Save"),b=m("Clear"),_=m("Upload"),D=m("DEMO"),S={class:"player"},M={id:"player"},C={class:"full-screen"};t();const T=y(((e,t,p,h,T,V)=>{const P=a("el-button"),E=a("playboard"),$=a("el-drawer"),B=a("el-slider"),I=a("el-col"),x=a("el-row"),j=i("loading");return o(),s("div",g,[l(x,{justify:"center"},{default:y((()=>[l(I,{xl:16,lg:20,md:24},{default:y((()=>[l("div",f,[l(P,{onClick:t[1]||(t[1]=e=>V.gameStart()),icon:"el-icon-video-play",round:"",type:"primary",disabled:1==T.playerState},{default:y((()=>[k])),_:1},8,["disabled"]),l(P,{onClick:t[2]||(t[2]=e=>V.gamePause()),icon:"el-icon-video-pause",round:"",disabled:1!=T.playerState},{default:y((()=>[v])),_:1},8,["disabled"]),l(P,{onClick:t[3]||(t[3]=e=>V.saveMapData()),plain:"",icon:"el-icon-finished",round:"",type:"warning"},{default:y((()=>[w])),_:1}),l(P,{onClick:t[4]||(t[4]=e=>V.clearMapData()),plain:"",icon:"el-icon-delete",round:"",type:"danger"},{default:y((()=>[b])),_:1}),l(P,{onClick:t[5]||(t[5]=e=>V.uploadMapData()),plain:"",icon:"el-icon-upload",round:"",type:"success"},{default:y((()=>[_])),_:1}),l(P,{onClick:t[7]||(t[7]=e=>T.drawer=!0),plain:"",icon:"el-icon-view",round:"",type:"info"},{default:y((()=>[D,l($,{title:"DEMO",modelValue:T.drawer,"onUpdate:modelValue":t[6]||(t[6]=e=>T.drawer=e),size:"60%"},{default:y((()=>[T.drawer?(o(),s(E,{key:0,music_data:T.music_data},null,8,["music_data"])):r("",!0)])),_:1},8,["modelValue"])])),_:1}),l(B,{modelValue:T.currentTime,"onUpdate:modelValue":t[8]||(t[8]=e=>T.currentTime=e),height:"300",max:T.music_data.duration,"show-input":"",onInput:t[9]||(t[9]=e=>V.seekTo()),onChange:t[10]||(t[10]=e=>V.seekToConfirm())},null,8,["modelValue","max"]),l(B,{modelValue:T.viewDegree,"onUpdate:modelValue":t[11]||(t[11]=e=>T.viewDegree=e),max:80,onChange:t[12]||(t[12]=e=>V.setViewDegree())},null,8,["modelValue"])]),l("div",{class:"row",style:V.editBoardStyle()},[l("div",S,[d(l("div",M,null,512),[[j,T.loading]])]),(o(!0),s(n,null,c(T.music_data.map_data,((e,t)=>(o(),s("div",C,[l("div",{class:"screen",id:"S"+e.key},null,8,["id"]),l(P,{class:"button",style:V.getButtonStyle(e.color),size:"medium",onClick:t=>V.hit(e.key,e.color,e.audio),id:"B"+e.key},{default:y((()=>[m(u(e.key),1)])),_:2},1032,["style","onClick","id"])])))),256))],4)])),_:1})])),_:1})])}));const V={data:()=>({music_data:{title:"a",mapper:"z",bpm:1,duration:200,difficulty:1.5,origin_song:"f",youtube_id:"VyvhvlYvRnc",video_url:"a",img_src:"c",producer:"d",love_count:0,play_count:0,view_count:0,map_data:[{key:"A",color:"rgb(200,10,15)",timeStamp:[.3,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19]},{key:"s",color:"rgb(0,10,15)",timeStamp:[.3,.8,.9,1.2,1.45]},{key:"d",color:"rgba(0,0,0,0.5)",timeStamp:[.3,.8,.9,1.2,1.45]},{key:"f",color:"rgba(255,255,255,1)",timeStamp:[.3,.8,.9,1.2,1.45]},{key:"4",color:"rgba(200,10,10,0.5)",timeStamp:[.3,.8,.9,1.2,1.45]},{key:"5",color:"rgba(200,200,10,0.5)",timeStamp:[.3,.8,.9,1.2,1.45]},{key:"6",color:"rgba(200,200,200,0.5)",timeStamp:[.3,.8,.9,1.2,1.45,.3,.8,.9,1.2,1.45]}]},drawer:!1,loading:!0,viewDegree:0,currentTime:null,choiceTime:null,player:null,score:0,combo:0,lifeTimer:null,playerState:0}),computed:{getViewDegree(){return this.$store.getters.getViewDegree}},methods:{gameStart(){console.log(this.player),this.player.playVideo(),this.lifeTimer=setInterval((()=>{1===this.playerState&&(this.currentTime+=.05)}),50)},gamePause(){this.player.pauseVideo(),clearInterval(this.lifeTimer)},editBoardStyle(){return{transform:`\n        rotateX(${this.viewDegree}deg)\n        scale(${1-this.viewDegree/170})`}},getButtonStyle:e=>({background:e}),hit(e,t,a){if(1===this.playerState){let i=new Audio;i.src="./audio/"+a+".mp3",i.play(),this.appendEffect(e,t),this.judge(),this.editMap(e,this.player.getCurrentTime())}},editMap(e,t){this.getAMapData(e).timeStamp.push(t)},getAMapData(e){return this.newMap.find((t=>t.key===e))},init(){this.newMap=this.music_data.map_data,this.viewDegree=this.getViewDegree},saveMapData(){this.newMap.forEach((e=>{e.timeStamp.sort()})),this.$store.commit("saveMapData",this.newMap),this.$notify({title:"Map Data",message:h("i",{style:"color: teal"},"已儲存資料")})},clearMapData(){this.$store.commit("clearMapData"),this.$notify({title:"Map Data",message:h("i",{style:"color: teal"},"已清空資料")})},uploadMapData(){this.$store.commit("uploadMapData"),this.$notify({title:"Map Data",message:h("i",{style:"color: teal"},"已上傳資料")})},setViewDegree(){this.$store.commit("setViewDegree",this.viewDegree)},judge(){this.score+=100,this.combo++,this.combo>10&&this.combo<=30?this.score+=5:this.combo>30&&this.combo<=50?this.score+=10:this.combo>50&&this.combo<=100?this.score+=25:this.combo>100&&this.combo<=200?this.score+=35:this.combo>200&&(this.score+=50)},appendEffect(e,t){const a=document.getElementById("S"+e),i=document.createElement("div");i.appendChild(document.createTextNode("perfect")),i.classList.add("perfectEffect"),i.style.top="80%",i.style.background=t,a.appendChild(i)},seekTo(){1!==this.playerState&&(this.player.seekTo(this.currentTime),this.gamePause())},seekToConfirm(){this.player.seekTo(this.currentTime),this.gamePause()},onPlayerReady(e){this.loading=!1,this.player.setPlaybackQuality("medium")},onPlayerStateChange(e){this.playerState=e.data}},mounted(){this.player=new YT.Player("player",{videoId:this.music_data.youtube_id,width:"100%",height:"100%",playerVars:{loop:1,rel:0},events:{onReady:this.onPlayerReady,onStateChange:this.onPlayerStateChange}}),this.init()},created(){const e=this;document.onkeydown=function(t){e.music_data.map_data.map((e=>{if(e.key.toLowerCase()===t.key.toLowerCase()){console.log(e.key);const t=document.getElementById("B"+e.key);t.click(),t.classList.add("show"),setTimeout((()=>{t.classList.remove("show")}),300)}}))}}};V.render=T,V.__scopeId="data-v-3bf4742c";export{V as default};
