import{p as e,h as t,r as a,o as i,c as o,a as s,k as l,F as r,l as n,b as d,t as c,j as h,u}from"./vendor.21c96ccb.js";const m=h();e("data-v-0c1bac3e");const p={id:"Edit"},y={class:"toolBar"},g=d("Play"),w=d("Pause"),k=d("Save"),D=d("Clear"),f=d("Upload"),S=d("DEMO"),v={class:"row"},b=s("div",{class:"player"},[s("div",{id:"player"})],-1),_={class:"full-screen"};t();const C=m(((e,t,h,u,C,M)=>{const V=a("el-header"),T=a("el-button"),x=a("playboard"),P=a("el-drawer"),$=a("el-slider"),B=a("el-col"),E=a("el-row");return i(),o("div",p,[s(V),s(E,{justify:"center"},{default:m((()=>[s(B,{xl:16,lg:20,md:24},{default:m((()=>[s("div",y,[s(T,{onClick:t[1]||(t[1]=e=>M.gameStart()),icon:"el-icon-video-play",round:"",type:"primary",disabled:1==C.playerState},{default:m((()=>[g])),_:1},8,["disabled"]),s(T,{onClick:t[2]||(t[2]=e=>M.gamePause()),icon:"el-icon-video-pause",round:"",disabled:1!=C.playerState},{default:m((()=>[w])),_:1},8,["disabled"]),s(T,{onClick:t[3]||(t[3]=e=>M.saveMapData()),plain:"",icon:"el-icon-finished",round:"",type:"warning"},{default:m((()=>[k])),_:1}),s(T,{onClick:t[4]||(t[4]=e=>M.clearMapData()),plain:"",icon:"el-icon-delete",round:"",type:"danger"},{default:m((()=>[D])),_:1}),s(T,{onClick:t[5]||(t[5]=e=>M.uploadMapData()),plain:"",icon:"el-icon-upload",round:"",type:"success"},{default:m((()=>[f])),_:1}),s(T,{onClick:t[7]||(t[7]=e=>C.drawer=!0),plain:"",icon:"el-icon-view",round:"",type:"info"},{default:m((()=>[S,s(P,{title:"DEMO",modelValue:C.drawer,"onUpdate:modelValue":t[6]||(t[6]=e=>C.drawer=e),size:"80%"},{default:m((()=>[C.drawer?(i(),o(x,{key:0,music_data:C.music_data,showProgressBar:!0},null,8,["music_data"])):l("",!0)])),_:1},8,["modelValue"])])),_:1}),s(T,{round:"",type:"info"},{default:m((()=>[s($,{modelValue:C.viewDegree,"onUpdate:modelValue":t[8]||(t[8]=e=>C.viewDegree=e),height:"10px",vertical:"",max:80,onChange:t[9]||(t[9]=e=>M.setViewDegree())},null,8,["modelValue"])])),_:1}),s($,{modelValue:C.currentTime,"onUpdate:modelValue":t[10]||(t[10]=e=>C.currentTime=e),height:"300",max:C.music_data.duration,"show-input":"",onInput:t[11]||(t[11]=e=>M.seekTo()),onChange:t[12]||(t[12]=e=>M.seekToConfirm())},null,8,["modelValue","max"])]),s("div",v,[s("div",{class:"col",style:M.editBoardStyle()},[b,(i(!0),o(r,null,n(C.music_data.map_data,((e,t)=>(i(),o("div",_,[s("div",{class:"screen",id:"S"+e.key},null,8,["id"]),s(T,{class:"button",style:M.getButtonStyle(e.color),size:"medium",onClick:t=>M.hit(e.key,e.color,e.audio),id:"B"+e.key},{default:m((()=>[d(c(e.key),1)])),_:2},1032,["style","onClick","id"])])))),256))],4)])])),_:1})])),_:1})])}));const M={data:()=>({music_data:{title:"a",mapper:"z",bpm:1,duration:200,difficulty:1.5,origin_song:"f",youtube_id:"VyvhvlYvRnc",video_url:"a",img_src:"c",producer:"d",love_count:0,play_count:0,view_count:0,map_data:[{index:0,key:"A",color:"rgb(200,10,15)",audio:"cracker",timeStamp:[]},{index:1,key:"s",color:"rgb(0,10,15)",audio:"cracker",timeStamp:[]},{index:2,key:"d",color:"rgba(0,0,0,0.5)",audio:"cracker",timeStamp:[]},{index:3,key:"f",color:"rgba(255,255,255,1)",audio:"cracker",timeStamp:[]},{index:4,key:"4",color:"rgba(200,10,10,0.5)",audio:"cracker",timeStamp:[]},{index:5,key:"5",color:"rgba(200,200,10,0.5)",audio:"cracker",timeStamp:[]},{index:6,key:"6",color:"rgba(200,200,200,0.5)",audio:"cracker",timeStamp:[]}]},drawer:!1,loading:!0,viewDegree:0,currentTime:null,choiceTime:null,player:null,score:0,combo:0,lifeTimer:null,playerState:0,watchData:[]}),computed:{getViewDegree(){return this.$store.getters.getViewDegree},getVolum(){return this.$store.getters.getVolum}},methods:{gameStart(){this.player.playVideo(),this.lifeTimer=setInterval((()=>{1===this.playerState&&(this.currentTime+=.015)}),15)},gamePause(){this.player.pauseVideo(),clearInterval(this.lifeTimer)},editBoardStyle(){return{transform:`\n        rotateX(${this.viewDegree}deg)\n        scale(${1-this.viewDegree/170})`}},getButtonStyle:e=>({background:e}),hit(e,t,a){if(1===this.playerState){if("mute"!==a){let e=new Audio;e.volume=this.getVolum,e.src="./audio/"+a+".mp3",e.play()}this.appendEffect(e,t),this.judge(),this.editMap(e,this.player.getCurrentTime()),console.log(e)}},editMap(e,t){this.getAMapData(e).timeStamp.push(t)},getAMapData(e){return this.newMap.find((t=>t.key===e))},init(){this.newMap=this.music_data.map_data,this.viewDegree=this.getViewDegree,this.music_data.map_data.map((e=>{const t=document.getElementById("B"+e.key);this.watchData.push({button:t,keyState:!1,timer:null,longSlide:[]})})),console.log(this.watchData)},saveMapData(){this.newMap.forEach((e=>{e.timeStamp.sort()})),this.$store.commit("saveMapData",this.newMap),this.$notify({title:"Map Data",message:u("i",{style:"color: teal"},"已儲存資料")})},clearMapData(){this.$store.commit("clearMapData"),this.newMap=[],this.$notify({title:"Map Data",message:u("i",{style:"color: teal"},"已清空資料")})},uploadMapData(){this.$store.commit("uploadMapData"),this.$notify({title:"Map Data",message:u("i",{style:"color: teal"},"已上傳資料")})},setViewDegree(){this.$store.commit("setViewDegree",this.viewDegree)},judge(){this.score+=100,this.combo++,this.combo>10&&this.combo<=30?this.score+=5:this.combo>30&&this.combo<=50?this.score+=10:this.combo>50&&this.combo<=100?this.score+=25:this.combo>100&&this.combo<=200?this.score+=35:this.combo>200&&(this.score+=50)},appendEffect(e,t){const a=document.getElementById("S"+e),i=document.createElement("div");i.appendChild(document.createTextNode("perfect")),i.classList.add("perfectEffect"),i.style.top="80%",i.style.background=t,a.appendChild(i)},seekTo(){1!==this.playerState&&(this.player.seekTo(this.currentTime),this.gamePause())},seekToConfirm(){this.player.seekTo(this.currentTime),this.gamePause()},onPlayerReady(){this.player.setPlaybackQuality("medium")},onPlayerStateChange(e){this.playerState=e.data},keydown(e,t){t?(this.watchData[e].button.click(),this.watchData[e].button.classList.add("show"),null===this.watchData[e].timer&&(this.watchData[e].timer=setInterval((()=>{this.watchData[e].longSlide.push(this.currentTime)}),100))):(clearInterval(this.watchData[e].timer),this.watchData[e].longSlide.length>8&&(this.watchData[e].longSlide=[this.watchData[e].longSlide[0],this.watchData[e].longSlide[this.watchData[e].longSlide.length-1]]),this.watchData[e].timer=null,this.watchData[e].longSlide=[],this.watchData[e].button.classList.remove("show"))}},mounted(){this.player=new YT.Player("player",{videoId:this.music_data.youtube_id,width:"100%",height:"100%",playerVars:{loop:1,rel:0},events:{onReady:this.onPlayerReady,onStateChange:this.onPlayerStateChange}}),this.init(),console.log(this.keyState)},created(){const e=this;document.onkeydown=function(t){e.music_data.map_data.map((a=>{a.key.toLowerCase()===t.key.toLowerCase()&&(e.watchData[a.index].keyState=!0)}))},document.onkeyup=function(t){e.music_data.map_data.map((a=>{a.key.toLowerCase()===t.key.toLowerCase()&&(e.watchData[a.index].keyState=!1)}))}},watch:{"watchData.0.keyState":{handler:function(e){this.keydown(0,e)},deep:!0},"watchData.1.keyState":{handler:function(e){this.keydown(1,e)},deep:!0},"watchData.2.keyState":{handler:function(e){this.keydown(2,e)},deep:!0},"watchData.3.keyState":{handler:function(e){this.keydown(3,e)},deep:!0},"watchData.4.keyState":{handler:function(e){this.keydown(4,e)},deep:!0},"watchData.5.keyState":{handler:function(e){this.keydown(5,e)},deep:!0},"watchData.6.keyState":{handler:function(e){this.keydown(6,e)},deep:!0}}};M.render=C,M.__scopeId="data-v-0c1bac3e";export{M as default};
