import{r as e,o as t,c as a,a as s,w as i,b as o,t as r,h as c,d as n,e as l,f as d,g as m,p as u,i as h,j as p,k as g,l as y,F as k,m as f,n as b,V as _,q as w,s as v,u as S}from"./vendor.98648e79.js";const T={id:"App"},D={id:"Nav"},C=o("Home"),x=o("User"),E=o("User");const $={data:()=>({isLogging:!1}),computed:{getUser(){return this.$store.getters.getUser}},methods:{async login(){let e="",t=this;window.gapi.load("auth2"),await window.gapi.auth2.init({clientId:"620173465-vtba7981i677t33lueo54hbca0pl0qke.apps.googleusercontent.com"}),await window.gapi.auth2.getAuthInstance().signIn().then((async function(a){e=a.Ws.Ht,console.log("Sign-in successful"),t.checkUserExist(e)}),(function(e){console.log("Error signing in",e)})),window.gapi.auth2.getAuthInstance().disconnect()},logout(){this.$confirm("是否登出","登出",{confirmButtonText:"登出",cancelButtonText:"取消",type:"warning",center:!0}).then((()=>{this.isLogging=!1,this.$store.commit("logout"),this.$router.push({name:"Home"}),this.$message({type:"success",message:"已登出"})})).catch((()=>{this.$message({type:"info",message:"取消登出"})}))},checkUserExist(e){this.axios.get("https://music-game-rhapsody.herokuapp.com/users",{params:{email:e}}).then((t=>{0==t.data.length?this.createUser(e):(this.$message({type:"info",message:"成功登入"}),this.$store.commit("login",t.data[0]),this.isLogging=!0,this.$router.push({name:"User"}))})).catch((e=>{console.log(e)}))},createUser(e){this.$prompt("新增帳號","請輸入暱稱",{confirmButtonText:"確認",cancelButtonText:"取消",inputErrorMessage:"名字請控制在20字內"}).then((({value:t})=>{this.$message({type:"success",message:"你好啊"+t}),this.axios.post("https://music-game-rhapsody.herokuapp.com/users",{name:t,email:e}).then((t=>{this.$notify({title:"成功",message:c("i",{style:"color: teal"},"成功創建帳號")}),this.checkUserExist(e)})).catch((e=>{this.$notify({title:"失敗",message:c("i",{style:"color: teal"},"帳號創建失敗")}),console.log(e)}))})).catch((()=>{this.$message({type:"info",message:"取消输入"})}))}},mounted(){null!==this.getUser.id&&(this.isLogging=!0)}};let B;$.render=function(c,n,l,d,m,u){const h=e("el-menu-item"),p=e("el-avatar"),g=e("el-menu"),y=e("router-view");return t(),a("div",T,[s("div",D,[s(g,{mode:"horizontal",router:!0},{default:i((()=>[s(h,{index:"/"},{default:i((()=>[C])),_:1}),m.isLogging?(t(),a(h,{key:0,index:"user"},{default:i((()=>[x])),_:1})):(t(),a(h,{key:1,index:"user",disabled:""},{default:i((()=>[E])),_:1})),m.isLogging?(t(),a(p,{key:2,class:"avastr",onClick:n[1]||(n[1]=e=>u.logout())},{default:i((()=>[o(r(u.getUser.name),1)])),_:1})):(t(),a(p,{key:3,class:"avastr",icon:"el-icon-user-solid",onClick:n[2]||(n[2]=e=>u.login())}))])),_:1})]),s(y)])};const L={},V=function(e,t){if(!t||0===t.length)return e();if(void 0===B){const e=document.createElement("link").relList;B=e&&e.supports&&e.supports("modulepreload")?"modulepreload":"preload"}return Promise.all(t.map((e=>{if((e=`./${e}`)in L)return;L[e]=!0;const t=e.endsWith(".css"),a=t?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${e}"]${a}`))return;const s=document.createElement("link");return s.rel=t?"stylesheet":B,t||(s.as="script",s.crossOrigin=""),s.href=e,document.head.appendChild(s),t?new Promise(((e,t)=>{s.addEventListener("load",e),s.addEventListener("error",t)})):void 0}))).then((()=>e()))},P=[{path:"/",name:"Home",component:()=>V((()=>import("./Home.dc1d0438.js")),["assets/Home.dc1d0438.js","assets/vendor.98648e79.js"])},{path:"/edit",name:"Edit",component:()=>V((()=>import("./Edit.9b2a76bb.js")),["assets/Edit.9b2a76bb.js","assets/Edit.28ae9f21.css","assets/vendor.98648e79.js"])},{path:"/play",name:"Play",component:()=>V((()=>import("./Play.3f6b6abc.js")),["assets/Play.3f6b6abc.js","assets/Play.0a2c714c.css","assets/vendor.98648e79.js"])},{path:"/form",name:"Form",component:()=>V((()=>import("./Form.5a1001f2.js")),["assets/Form.5a1001f2.js","assets/Form.36e3407d.css","assets/vendor.98648e79.js"])},{path:"/user",name:"User",component:()=>V((()=>import("./User.9d676784.js")),["assets/User.9d676784.js","assets/vendor.98648e79.js"])}],U=n({history:l("#"),routes:P});var I=d({state:{user:{name:"",id:null},setting:{volum:.5,bpm:1,viewDegree:15,mapSetting:[[{key:"a",color:"#cd004b",audio:"cracker",timeStamp:[]}],[{key:"a",color:"#cd004b",audio:"cracker",timeStamp:[]},{key:"d",color:"#fcb711",audio:"cracker",timeStamp:[]}],[{key:"a",color:"#cd004b",audio:"cracker",timeStamp:[]},{key:"s",color:"#f37023",audio:"cracker",timeStamp:[]},{key:"d",color:"#fcb711",audio:"cracker",timeStamp:[]}],[{key:"a",color:"#cd004b",audio:"cracker",timeStamp:[]},{key:"s",color:"#f37023",audio:"cracker",timeStamp:[]},{key:"5",color:"#6561ac",audio:"cracker",timeStamp:[]},{key:"6",color:"#292526",audio:"cracker",timeStamp:[]}],[{key:"a",color:"#cd004b",audio:"cracker",timeStamp:[]},{key:"s",color:"#f37023",audio:"cracker",timeStamp:[]},{key:"4",color:"#0087d2",audio:"cracker",timeStamp:[]},{key:"5",color:"#6561ac",audio:"cracker",timeStamp:[]},{key:"6",color:"#292526",audio:"cracker",timeStamp:[]}],[{key:"a",color:"#cd004b",audio:"cracker",timeStamp:[]},{key:"s",color:"#f37023",audio:"cracker",timeStamp:[]},{key:"d",color:"#fcb711",audio:"cracker",timeStamp:[]},{key:"4",color:"#0087d2",audio:"cracker",timeStamp:[]},{key:"5",color:"#6561ac",audio:"cracker",timeStamp:[]},{key:"6",color:"#292526",audio:"cracker",timeStamp:[]}],[{key:"a",color:"#cd004b",audio:"cracker",timeStamp:[]},{key:"s",color:"#f37023",audio:"cracker",timeStamp:[]},{key:"d",color:"#fcb711",audio:"cracker",timeStamp:[]},{key:"f",color:"#0eb24e",audio:"cracker",timeStamp:[]},{key:"4",color:"#0087d2",audio:"cracker",timeStamp:[]},{key:"5",color:"#6561ac",audio:"cracker",timeStamp:[]},{key:"6",color:"#292526",audio:"cracker",timeStamp:[]}]]},edit_music:[]},getters:{getEditMusic:e=>e.edit_music,getBpm:e=>e.setting.bpm,getViewDegree:e=>e.setting.viewDegree,getMapSetting:e=>e.setting.mapSetting,getVolum:e=>e.setting.volum,getUser:e=>e.user},mutations:{saveEditMusic(e,t){void 0===e.edit_music.find((e=>e.id===t.id))&&e.edit_music.push(t)},clearEditMusic(e,t){let a=e.edit_music.find((e=>e.id===t));e.edit_music.pop(a)},setBpm(e,t){e.setting.bpm=t},setVolum(e,t){e.setting.volum=t},setViewDegree(e,t){e.setting.viewDegree=t},saveSetting(e,t){e.setting.mapSetting[t.length]=t},login(e,t){e.user.name=t.name,e.user.id=t.id},logout(e){e.user={name:"",id:null}}},actions:{},modules:{},plugins:[m()]});const j=g("data-v-ccf3931e");u("data-v-ccf3931e");const M=o("去新增曲目"),O={class:"image"},R={class:"tool"};h();const A=j(((i,c,n,l,d,m)=>{const u=e("el-button"),h=e("el-result"),g=e("el-card"),y=e("el-descriptions-item"),k=e("el-descriptions");return n.demo?(t(),a(g,{key:0,class:"music_card",shadow:"hover","body-style":{marginTop:"20%"}},{default:j((()=>[s(h,{icon:"plus",title:"新增曲目"},{extra:j((()=>[s(u,{type:"primary",size:"medium",onClick:c[1]||(c[1]=e=>m.addMusic())},{default:j((()=>[M])),_:1})])),_:1})])),_:1})):(t(),a(g,{key:1,class:"music_card",onClick:c[4]||(c[4]=e=>m.playMusic(n.music_data.id)),shadow:"hover","body-style":{padding:"0px"}},{default:j((()=>[s("div",O,[s("img",{src:n.music_data.img_src},null,8,["src"])]),s(k,{class:"info",title:n.music_data.title,column:1},p({default:j((()=>[s(y,{class:"info",label:"作者"},{default:j((()=>[o(r(n.music_data.mapper),1)])),_:1}),s(y,{class:"info",label:"原曲"},{default:j((()=>[o(r(n.music_data.origin_song),1)])),_:1}),s(y,{class:"info",label:"原曲頻道"},{default:j((()=>[o(r(n.music_data.producer),1)])),_:1}),s(y,{class:"info",label:"難度"},{default:j((()=>[o(r(n.music_data.difficulty),1)])),_:1}),s(y,{class:"info",label:"鍵位"},{default:j((()=>[o(r(n.music_data.key_count),1)])),_:1}),s(y,{class:"info",label:"速度"},{default:j((()=>[o(r(n.music_data.bpm),1)])),_:1}),s(y,{class:"info",label:"長度"},{default:j((()=>[o(r(n.music_data.duration),1)])),_:1}),s(y,{class:"info",label:"收藏數"},{default:j((()=>[o(r(n.music_data.love_count),1)])),_:1}),s(y,{class:"info",label:"遊玩數"},{default:j((()=>[o(r(n.music_data.play_count),1)])),_:1}),s(y,{class:"info",label:"瀏覽數"},{default:j((()=>[o(r(n.music_data.view_count),1)])),_:1})])),_:2},[n.music_data.mapper==m.getUser.name?{name:"extra",fn:j((()=>[s("div",R,[s(u,{type:"primary",icon:"el-icon-edit",circle:"",onClick:c[2]||(c[2]=e=>m.editMusic(n.music_data.id))}),s(u,{type:"danger",icon:"el-icon-delete",circle:"",onClick:c[3]||(c[3]=e=>m.deleteMusic(n.music_data.id))})])]))}:void 0]),1032,["title"])])),_:1}))}));const N={props:{music_data:Object,demo:{type:Boolean,default:!1}},data:()=>({}),computed:{getUser(){return this.$store.getters.getUser}},methods:{addMusic(){this.$router.push({name:"Form"})},playMusic(e){this.$router.push({name:"Play",query:{id:e}})},deleteMusic(e){event.stopPropagation(),this.axios.delete("https://music-game-rhapsody.herokuapp.com/music_data",{params:{id:this.music_data.id}}).then((e=>{this.$notify({title:"刪除",message:c("i",{style:"color: teal"},"已刪除該音樂")})})).catch((e=>{console.log(e)}))},editMusic(e){event.stopPropagation(),this.$router.push({name:"Edit",query:{id:e}})}}};N.render=A,N.__scopeId="data-v-ccf3931e";const q=g("data-v-bf57b1a2");u("data-v-bf57b1a2");const H={id:"playboard"},F={class:"toolBar"},z=o("Play"),Y=o("Pause"),W=o("Restart"),Q=s("br",null,null,-1),X=s("div",{class:"player"},[s("div",{id:"player"})],-1),G={class:"full-screen"};h();const J=q(((i,c,n,l,d,m)=>{const u=e("el-button"),h=e("el-slider"),p=e("game_slider");return t(),a("div",H,[s("div",F,[s(u,{onClick:c[1]||(c[1]=e=>m.gameStart()),icon:"el-icon-video-play",round:"",type:"primary",disabled:1==d.playerState},{default:q((()=>[z])),_:1},8,["disabled"]),s(u,{onClick:c[2]||(c[2]=e=>m.gamePause()),icon:"el-icon-video-pause",round:"",type:"success",disabled:1!=d.playerState},{default:q((()=>[Y])),_:1},8,["disabled"]),s(u,{onClick:c[3]||(c[3]=e=>m.gameRestart()),icon:"el-icon-refresh-left",round:"",type:"warning"},{default:q((()=>[W])),_:1}),s(u,{round:"",type:"info"},{default:q((()=>[s(h,{modelValue:d.viewDegree,"onUpdate:modelValue":c[4]||(c[4]=e=>d.viewDegree=e),height:"10px",vertical:"",max:80,onChange:c[5]||(c[5]=e=>m.setViewDegree())},null,8,["modelValue"])])),_:1}),n.showProgressBar?(t(),a(h,{key:0,modelValue:d.currentTime,"onUpdate:modelValue":c[6]||(c[6]=e=>d.currentTime=e),max:n.music_data.duration,"show-input":"",onInput:c[7]||(c[7]=e=>m.seekTo()),onChange:c[8]||(c[8]=e=>m.seekToConfirm())},null,8,["modelValue","max"])):y("",!0),Q,s("span",null,"分數:"+r(d.score)+" 分 ",1),s("span",null,"| Combo:"+r(d.combo)+" 次",1)]),s("div",{class:"row",style:m.playBoardStyle()},[X,(t(!0),a(k,null,f(n.music_data.map_data,((e,i)=>(t(),a("div",G,[s("div",{class:"screen",id:"S"+e.key},[(t(!0),a(k,null,f(e.timeStamp,((s,i)=>(t(),a(p,{onClick:c[9]||(c[9]=e=>m.destroy()),class:e.key,color:e.color,bornTime:s,currentTime:d.currentTime,bpm:m.getBpm,restart:d.restart},null,8,["class","color","bornTime","currentTime","bpm","restart"])))),256))],8,["id"]),s(u,{class:"button",style:m.getButtonStyle(e.color),size:"medium",onClick:t=>m.hit(e.key,e.color,e.audio),id:"B"+e.key},{default:q((()=>[o(r(e.key),1)])),_:2},1032,["style","onClick","id"])])))),256))],4)])}));const K={props:{music_data:Object,showProgressBar:{type:Boolean,default:!1}},data:()=>({viewDegree:0,currentTime:null,choiceTime:null,player:null,score:0,combo:0,maxCombo:0,lifeTimer:null,playerState:0,restart:!1,watchData:[]}),computed:{getMapData(){return this.$store.getters.getMapData},getBpm(){return this.music_data.bpm},getViewDegree(){return this.$store.getters.getViewDegree},getVolum(){return this.$store.getters.getVolum},judgeLine(){return 1===this.getBpm?[95,92,87]:1.5===this.getBpm?[94.5,91,85]:2===this.getBpm?[94,90,82]:.5===this.getBpm?[96,94,90]:.25===this.getBpm?[97,95.5,92]:void 0}},methods:{gameStart(){this.restart=!1,this.player.playVideo(),this.lifeTimer=setInterval((()=>{1===this.playerState&&(this.currentTime+=.01)}),10)},gamePause(){this.player.pauseVideo(),clearInterval(this.lifeTimer)},gameRestart(){this.restart=!0,this.currentTime=0,this.player.seekTo(this.currentTime),this.gamePause(),this.score=0,this.combo=0,this.maxCombo=0},playBoardStyle(){return{transform:`\n        rotateX(${this.viewDegree}deg)\n        scale(${1-this.viewDegree/170})`}},getButtonStyle:e=>({background:e}),hit(e,t,a){if(1===this.playerState){const s=document.getElementsByClassName(e);if("mute"!==a){let e=new Audio;e.volume=this.getVolum,e.src="./audio/"+a+".mp3",e.play()}if(s.length>0){let a=parseInt(s[0].style.top);a>50&&(this.appendEffect(e,a,t),s[0].click())}}},keydown(e,t){t?(this.watchData[e].button.click(),this.watchData[e].button.classList.add("show")):this.watchData[e].button.classList.remove("show")},judge(e){var t="";return this.judgeLine[0]<=e?(this.score+=100,this.combo++,t="perfect"):this.judgeLine[1]<=e&&e<this.judgeLine[0]?(this.score+=30,this.combo++,t="excellent"):this.judgeLine[2]<=e&&e<this.judgeLine[1]?(this.score+=10,this.combo++,t="good"):(this.combo=0,t="miss"),this.combo>10&&this.combo<=30?this.score+=5:this.combo>30&&this.combo<=50?this.score+=10:this.combo>50&&this.combo<=100?this.score+=25:this.combo>100&&this.combo<=200?this.score+=35:this.combo>200&&(this.score+=50),this.combo>this.maxCombo&&(this.maxCombo=this.combo),t},init(){this.viewDegree=this.getViewDegree,this.music_data.map_data.map((e=>{const t=document.getElementById("B"+e.key);this.watchData.push({button:t,keyState:!1})}));const e=this;window.onkeydown=function(t){e.music_data.map_data.map((a=>{if(a.key.toLowerCase()===t.key.toLowerCase()){let t=e.music_data.map_data.indexOf(a);e.watchData[t].keyState=!0}}))},window.onkeyup=function(t){e.music_data.map_data.map((a=>{if(a.key.toLowerCase()===t.key.toLowerCase()){let t=e.music_data.map_data.indexOf(a);e.watchData[t].keyState=!1}}))},this.setYoutube()},setYoutube(){this.player=new YT.Player("player",{videoId:this.music_data.youtube_id,width:"100%",height:"100%",playerVars:{loop:1,rel:0,controls:0},events:{onReady:this.onPlayerReady,onStateChange:this.onPlayerStateChange}})},appendEffect(e,t,a){const s=document.getElementById("S"+e),i=document.createElement("div");let o=this.judge(t);i.appendChild(document.createTextNode(`${o}`)),s.appendChild(i),"perfect"===o?i.classList.add("perfectEffect"):"excellent"===o?i.classList.add("excellentEffect"):"good"===o?i.classList.add("goodEffect"):i.classList.add("effect"),i.style.top=t+"%",i.style.background=a},destroy(){this.$emit("destroy")},seekTo(){1!==this.playerState&&(this.gamePause(),this.restart=!0,this.player.seekTo(this.currentTime))},seekToConfirm(){this.gamePause(),this.restart=!0,this.player.seekTo(this.currentTime)},onPlayerReady(e){this.player.setPlaybackQuality("medium")},onPlayerStateChange(e){this.playerState=e.data},setViewDegree(){this.$store.commit("setViewDegree",this.viewDegree)},over(){this.$alert(`恭喜完成${this.music_data.title}\n        你獲得${this.score}分!\n        最高COMBO${this.maxCombo}次\n        `,"過關",{confirmButtonText:"確定"})}},mounted(){this.init()},watch:{"watchData.0.keyState":{handler:function(e){this.keydown(0,e)},deep:!0},"watchData.1.keyState":{handler:function(e){this.keydown(1,e)},deep:!0},"watchData.2.keyState":{handler:function(e){this.keydown(2,e)},deep:!0},"watchData.3.keyState":{handler:function(e){this.keydown(3,e)},deep:!0},"watchData.4.keyState":{handler:function(e){this.keydown(4,e)},deep:!0},"watchData.5.keyState":{handler:function(e){this.keydown(5,e)},deep:!0},"watchData.6.keyState":{handler:function(e){this.keydown(6,e)},deep:!0}}};K.render=J,K.__scopeId="data-v-bf57b1a2";const Z=g("data-v-f7086e96")(((e,s,i,o,r,c)=>c.exist?(t(),a("div",{key:0,class:"game_slider",style:c.gameSliderStyle,onClick:s[1]||(s[1]=e=>c.destroy())},null,4)):y("",!0)));const ee={data:()=>({break:!1}),props:{bpm:Number,color:String,bornTime:Number,currentTime:Number,restart:{type:Boolean,default:!1}},computed:{gameSliderStyle(){return this.top>100&&(this.break=!0),{top:this.top+"%",background:this.color}},top(){return this.sneak-this.bornTime>0?75*(this.sneak-this.bornTime)*this.bpm:0},sneak(){if(!this.break){if(1===this.bpm)return this.currentTime+1.28;if(1.5===this.bpm)return this.currentTime+.84;if(2===this.bpm)return this.currentTime+.6;if(.5===this.bpm)return this.currentTime+2.67;if(.25===this.bpm)return this.currentTime+5.28}},exist(){return this.top>0&&this.top<100&&!1===this.break}},methods:{destroy(){this.break=!0}},watch:{restart(){this.break=!1}}};ee.render=Z,ee.__scopeId="data-v-f7086e96";const te=b($);te.use(U),te.use(I),te.use(_),te.use(w),te.use(v,S),te.component("music_card",N),te.component("playboard",K),te.component("game_slider",ee),te.mount("#app");
