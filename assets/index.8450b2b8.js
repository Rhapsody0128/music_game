import{r as e,o as t,c as a,a as i,w as o,b as s,d as r,e as c,f as l,g as d,p as m,h as n,t as u,i as p,j as h,k as g,l as y,F as k,m as b,n as _,V as f,q as v,s as S,u as T}from"./vendor.8692c601.js";const w={id:"App"},D={id:"Nav"},V=s("Home"),L=s("Edit"),E=s("Play"),P=s("Form"),B=s("User");const C={};let j;C.render=function(s,r){const c=e("el-menu-item"),l=e("el-menu"),d=e("router-view");return t(),a("div",w,[i("div",D,[i(l,{class:"el-menu-demo",mode:"horizontal",router:!0},{default:o((()=>[i(c,{index:"/"},{default:o((()=>[V])),_:1}),i(c,{index:"edit"},{default:o((()=>[L])),_:1}),i(c,{index:"play"},{default:o((()=>[E])),_:1}),i(c,{index:"form"},{default:o((()=>[P])),_:1}),i(c,{index:"user"},{default:o((()=>[B])),_:1})])),_:1})]),i(d)])};const x={},I=function(e,t){if(!t||0===t.length)return e();if(void 0===j){const e=document.createElement("link").relList;j=e&&e.supports&&e.supports("modulepreload")?"modulepreload":"preload"}return Promise.all(t.map((e=>{if((e=`./${e}`)in x)return;x[e]=!0;const t=e.endsWith(".css"),a=t?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${e}"]${a}`))return;const i=document.createElement("link");return i.rel=t?"stylesheet":j,t||(i.as="script",i.crossOrigin=""),i.href=e,document.head.appendChild(i),t?new Promise(((e,t)=>{i.addEventListener("load",e),i.addEventListener("error",t)})):void 0}))).then((()=>e()))},$=[{path:"/",name:"Home",component:()=>I((()=>import("./Home.c47f716f.js")),["assets/Home.c47f716f.js","assets/vendor.8692c601.js"])},{path:"/edit",name:"Edit",component:()=>I((()=>import("./Edit.cdec67fa.js")),["assets/Edit.cdec67fa.js","assets/Edit.26b3620e.css","assets/vendor.8692c601.js"])},{path:"/play",name:"Play",component:()=>I((()=>import("./Play.0bab9d5c.js")),["assets/Play.0bab9d5c.js","assets/Play.b5151c9d.css","assets/vendor.8692c601.js"])},{path:"/form",name:"Form",component:()=>I((()=>import("./Form.741fbf5d.js")),["assets/Form.741fbf5d.js","assets/Form.125c697b.css","assets/vendor.8692c601.js"])},{path:"/user",name:"User",component:()=>I((()=>import("./User.c14dea23.js")),["assets/User.c14dea23.js","assets/vendor.8692c601.js"])}],R=r({history:c("#"),routes:$});var O=l({state:{user:{name:"Gary",id:0},setting:{volum:.5,bpm:1,viewDegree:15,mapSetting:[[{key:"a",color:"#cd004b",audio:"cracker",timeStamp:[]}],[{key:"a",color:"#cd004b",audio:"cracker",timeStamp:[]},{key:"d",color:"#fcb711",audio:"cracker",timeStamp:[]}],[{key:"a",color:"#cd004b",audio:"cracker",timeStamp:[]},{key:"s",color:"#f37023",audio:"cracker",timeStamp:[]},{key:"d",color:"#fcb711",audio:"cracker",timeStamp:[]}],[{key:"a",color:"#cd004b",audio:"cracker",timeStamp:[]},{key:"s",color:"#f37023",audio:"cracker",timeStamp:[]},{key:"5",color:"#6561ac",audio:"cracker",timeStamp:[]},{key:"6",color:"#292526",audio:"cracker",timeStamp:[]}],[{key:"a",color:"#cd004b",audio:"cracker",timeStamp:[]},{key:"s",color:"#f37023",audio:"cracker",timeStamp:[]},{key:"4",color:"#0087d2",audio:"cracker",timeStamp:[]},{key:"5",color:"#6561ac",audio:"cracker",timeStamp:[]},{key:"6",color:"#292526",audio:"cracker",timeStamp:[]}],[{key:"a",color:"#cd004b",audio:"cracker",timeStamp:[]},{key:"s",color:"#f37023",audio:"cracker",timeStamp:[]},{key:"d",color:"#fcb711",audio:"cracker",timeStamp:[]},{key:"4",color:"#0087d2",audio:"cracker",timeStamp:[]},{key:"5",color:"#6561ac",audio:"cracker",timeStamp:[]},{key:"6",color:"#292526",audio:"cracker",timeStamp:[]}],[{key:"a",color:"#cd004b",audio:"cracker",timeStamp:[]},{key:"s",color:"#f37023",audio:"cracker",timeStamp:[]},{key:"d",color:"#fcb711",audio:"cracker",timeStamp:[]},{key:"f",color:"#0eb24e",audio:"cracker",timeStamp:[]},{key:"4",color:"#0087d2",audio:"cracker",timeStamp:[]},{key:"5",color:"#6561ac",audio:"cracker",timeStamp:[]},{key:"6",color:"#292526",audio:"cracker",timeStamp:[]}]]},mapData:null},getters:{getMapData:e=>e.mapData,getBpm:e=>e.setting.bpm,getViewDegree:e=>e.setting.viewDegree,getMapSetting:e=>e.setting.mapSetting,getVolum:e=>e.setting.volum,getUser:e=>e.user},mutations:{saveMapData(e,t){e.mapData=t},clearMapData(e){e.mapData=null},uploadMapData(e){e.mapData=null},setBpm(e,t){e.setting.bpm=t},setVolum(e,t){e.setting.volum=t},setViewDegree(e,t){e.setting.viewDegree=t}},actions:{},modules:{},plugins:[d()]});const A=p("data-v-13bb6309");m("data-v-13bb6309");const M={class:"image"};n();const N=A(((o,r,c,l,d,m)=>{const n=e("el-descriptions-item"),p=e("el-descriptions"),h=e("el-card");return t(),a(h,{class:"music_card",shadow:"hover","body-style":{padding:"0px"}},{default:A((()=>[i("div",M,[i("img",{src:c.music_data.img_src},null,8,["src"])]),i(p,{class:"info",title:c.music_data.title,column:1},{default:A((()=>[i(n,{label:"作者"},{default:A((()=>[s(u(c.music_data.mapper),1)])),_:1}),i(n,{label:"原曲"},{default:A((()=>[s(u(c.music_data.origin_song),1)])),_:1}),i(n,{label:"原曲頻道"},{default:A((()=>[s(u(c.music_data.producer),1)])),_:1}),i(n,{label:"難度"},{default:A((()=>[s(u(c.music_data.difficulty),1)])),_:1}),i(n,{label:"鍵位"},{default:A((()=>[s(u(c.music_data.key_count),1)])),_:1}),i(n,{label:"速度"},{default:A((()=>[s(u(c.music_data.bpm),1)])),_:1}),i(n,{label:"長度"},{default:A((()=>[s(u(c.music_data.duration),1)])),_:1}),i(n,{label:"收藏數"},{default:A((()=>[s(u(c.music_data.love_count),1)])),_:1}),i(n,{label:"遊玩數"},{default:A((()=>[s(u(c.music_data.play_count),1)])),_:1}),i(n,{label:"瀏覽數"},{default:A((()=>[s(u(c.music_data.view_count),1)])),_:1})])),_:1},8,["title"])])),_:1})}));const U={props:{music_data:Object},data:()=>({})};U.render=N,U.__scopeId="data-v-13bb6309";const F=p("data-v-ea3822e6");m("data-v-ea3822e6");const H={id:"playboard"},q={class:"toolBar"},z=s("Play"),G=s("Pause"),Q=s("Restart"),W={class:"player"},X=i("div",{id:"player"},null,-1),Y={class:"full-screen"};n();const J=F(((o,r,c,l,d,m)=>{const n=e("el-button"),p=e("el-slider"),_=e("game_slider"),f=h("loading");return t(),a("div",H,[g(i("div",q,[i(n,{onClick:r[1]||(r[1]=e=>m.gameStart()),icon:"el-icon-video-play",round:"",type:"primary",disabled:1==d.playerState},{default:F((()=>[z])),_:1},8,["disabled"]),i(n,{onClick:r[2]||(r[2]=e=>m.gamePause()),icon:"el-icon-video-pause",round:"",type:"success",disabled:1!=d.playerState},{default:F((()=>[G])),_:1},8,["disabled"]),i(n,{onClick:r[3]||(r[3]=e=>m.gameRestart()),icon:"el-icon-refresh-left",round:"",type:"warning"},{default:F((()=>[Q])),_:1}),i(p,{modelValue:d.currentTime,"onUpdate:modelValue":r[4]||(r[4]=e=>d.currentTime=e),height:"300",max:c.music_data.duration,"show-input":"",onInput:r[5]||(r[5]=e=>m.seekTo()),onChange:r[6]||(r[6]=e=>m.seekToConfirm())},null,8,["modelValue","max"]),c.showProgressBar?(t(),a(p,{key:0,modelValue:d.viewDegree,"onUpdate:modelValue":r[7]||(r[7]=e=>d.viewDegree=e),max:80,onChange:r[8]||(r[8]=e=>m.setViewDegree())},null,8,["modelValue"])):y("",!0),i("p",null,u(d.score),1)],512),[[f,d.loading]]),i("div",{class:"row",style:m.playBoardStyle()},[g(i("div",W,[X],512),[[f,d.loading]]),(t(!0),a(k,null,b(c.music_data.map_data,((e,o)=>(t(),a("div",Y,[i("div",{class:"screen",id:"S"+e.key},[(t(!0),a(k,null,b(e.timeStamp,((i,o)=>(t(),a(_,{onClick:r[9]||(r[9]=e=>m.destroy()),class:e.key,color:e.color,bornTime:i,currentTime:d.currentTime,bpm:m.getBpm,restart:d.restart},null,8,["class","color","bornTime","currentTime","bpm","restart"])))),256))],8,["id"]),i(n,{class:"button",style:m.getButtonStyle(e.color),size:"medium",onClick:t=>m.hit(e.key,e.color,e.audio),id:"B"+e.key},{default:F((()=>[s(u(e.key),1)])),_:2},1032,["style","onClick","id"])])))),256))],4)])}));const K={props:{music_data:Object,showProgressBar:{type:Boolean,default:!1}},data:()=>({loading:!0,viewDegree:0,currentTime:null,choiceTime:null,player:null,score:0,combo:0,maxCombo:0,lifeTimer:null,playerState:0,restart:!1}),computed:{getMapData(){return this.$store.getters.getMapData},getBpm(){return this.$store.getters.getBpm},getViewDegree(){return this.$store.getters.getViewDegree},getVolum(){return this.$store.getters.getVolum},judgeLine(){return 1===this.getBpm?[80,79,82,75,85,70]:1.5===this.getBpm?[80.5,78.5,83,74,85,68]:2===this.getBpm?[81,78,84,73,89,66]:.5===this.getBpm?[79.8,79.2,82,76,84,72]:.25===this.getBpm?[79.6,79.4,81,78,83,75]:void 0}},methods:{gameStart(){this.restart=!1,this.player.playVideo(),this.lifeTimer=setInterval((()=>{1===this.playerState&&(this.currentTime+=.015)}),15)},gamePause(){this.player.pauseVideo(),clearInterval(this.lifeTimer)},gameRestart(){this.restart=!0,this.currentTime=0,this.player.seekTo(this.currentTime),this.gamePause(),this.score=0,this.combo=0,this.maxCombo=0},playBoardStyle(){return{transform:`\n        rotateX(${this.viewDegree}deg)\n        scale(${1-this.viewDegree/170})`}},getButtonStyle:e=>({background:e}),hit(e,t,a){if(1===this.playerState){const i=document.getElementsByClassName(e);if("mute"!==a){let e=new Audio;e.volume=this.getVolum,e.src="./audio/"+a+".mp3",e.play()}i.length>0&&(this.appendEffect(e,i[0].style.top,t),i[0].click())}},judge(e){var t=parseInt(e),a="";return this.judgeLine[0]>=t&&t>=this.judgeLine[1]?(this.score+=100,this.combo++,a="perfect"):this.judgeLine[2]>=t&&t>=this.judgeLine[0]||this.judgeLine[1]>=t&&t>=this.judgeLine[3]?(this.score+=30,this.combo++,a="excellent"):this.judgeLine[4]>=t&&t>=this.judgeLine[2]||this.judgeLine[3]>=t&&t>=this.judgeLine[5]?(this.score+=10,this.combo++,a="good"):(this.combo=0,a="miss"),this.combo>10&&this.combo<=30?this.score+=5:this.combo>30&&this.combo<=50?this.score+=10:this.combo>50&&this.combo<=100?this.score+=25:this.combo>100&&this.combo<=200?this.score+=35:this.combo>200&&(this.score+=50),this.combo>this.maxCombo&&(this.maxCombo=this.combo),a},appendEffect(e,t,a){const i=document.getElementById("S"+e),o=document.createElement("div");let s=this.judge(t);o.appendChild(document.createTextNode(`${s}`)),i.appendChild(o),"perfect"===s?o.classList.add("perfectEffect"):"excellent"===s?o.classList.add("excellentEffect"):"good"===s?o.classList.add("goodEffect"):o.classList.add("effect"),o.style.top=t,o.style.background=a},destroy(){this.$emit("destroy")},seekTo(){1!==this.playerState&&(this.gamePause(),this.restart=!0,this.player.seekTo(this.currentTime))},seekToConfirm(){this.gamePause(),this.restart=!0,this.player.seekTo(this.currentTime)},onPlayerReady(e){this.loading=!1,this.player.setPlaybackQuality("medium")},onPlayerStateChange(e){this.playerState=e.data},setViewDegree(){this.$store.commit("setViewDegree",this.viewDegree)}},mounted(){this.viewDegree=this.getViewDegree,this.player=new YT.Player("player",{videoId:this.music_data.youtube_id,width:"100%",height:"100%",playerVars:{loop:1,rel:0},events:{onReady:this.onPlayerReady,onStateChange:this.onPlayerStateChange}})},created(){const e=this;document.onkeydown=function(t){e.music_data.map_data.map((e=>{if(e.key.toLowerCase()===t.key.toLowerCase()){const t=document.getElementById("B"+e.key);t.click(),t.classList.add("show"),setTimeout((()=>{t.classList.remove("show")}),300)}}))}}};K.render=J,K.__scopeId="data-v-ea3822e6";const Z=p("data-v-03d9451e")(((e,i,o,s,r,c)=>c.exist?(t(),a("div",{key:0,class:"game_slider",style:c.gameSliderStyle,onClick:i[1]||(i[1]=e=>c.destroy())},null,4)):y("",!0)));const ee={data:()=>({break:!1}),props:{bpm:Number,color:String,bornTime:Number,currentTime:Number,restart:{type:Boolean,default:!1}},computed:{gameSliderStyle(){return{top:this.top+"%",background:this.color}},top(){return this.sneak-this.bornTime>0?75*(this.sneak-this.bornTime)*this.bpm:0},sneak(){return 1===this.bpm?this.currentTime+1.15:1.5===this.bpm?this.currentTime+.83:2===this.bpm?this.currentTime+.56:.5===this.bpm?this.currentTime+2.1:.25===this.bpm?this.currentTime+4.35:void 0},exist(){return this.top>0&&this.top<100&&!1===this.break}},methods:{destroy(){this.break=!0}},watch:{restart(){this.break=!1}}};ee.render=Z,ee.__scopeId="data-v-03d9451e";const te=_(C);te.use(R),te.use(O),te.use(f),te.use(v),te.use(S,T),te.component("music_card",U),te.component("playboard",K),te.component("game_slider",ee),te.mount("#app");
